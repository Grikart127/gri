<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OPTIMA Mod√ºler | v6.0 Ba≈üyapƒ±t</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-color: #f5f5f5; 
            --panel-bg: #ffffff; 
            --text-main: #111111; 
            --text-muted: #484848;
            --border-color: #dfdfdf;
            --brand-blue: #0058a3;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { display: flex; height: 100vh; background: var(--bg-color); overflow: hidden; color: var(--text-main); }

        .render-area { 
            width: 75%; height: 100vh; position: relative; 
            display: flex; align-items: center; justify-content: center; 
            background: #f0f0f0; padding: 20px; 
        }
        
        .canvas-aspect {
            position: relative;
            aspect-ratio: 1920 / 1080;
            width: 100%;
            max-width: calc((100vh - 40px) * (1920 / 1080));
            max-height: 100%;
            background: url('AnaSahne.png') center/100% 100% no-repeat;
        }
        
        .floating-top-bar { position: absolute; top: 25px; right: 30px; display: flex; align-items: center; gap: 10px; z-index: 500; }
        .price-pill { background: #fff; padding: 10px 20px; border-radius: 30px; font-weight: 700; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 5px; min-width: 130px; justify-content: center; }
        .btn-summary { background: var(--brand-blue); color: #fff; border: none; padding: 10px 24px; border-radius: 30px; font-weight: 600; font-size: 14px; cursor: pointer; transition: 0.2s; }
        .btn-summary:hover { background: #004a89; }

        #main-govde { position: absolute; inset: 0; background-size: 100% 100%; background-position: center; background-repeat: no-repeat; z-index: 10; transition: background-image 0.5s ease-in-out; }
        .layer-kapak { position: absolute; inset: 0; background-size: 100% 100%; background-position: center; background-repeat: no-repeat; z-index: 20; opacity: 0; transition: opacity 0.3s ease, background-image 0.3s ease; pointer-events: none; }
        
        /* DOKUNMATƒ∞K ALAN, HOVER PARLAMASI VE RADAR HALKASI */
        .hotspot-trigger { 
            position: absolute; z-index: 100; cursor: pointer; 
            background: transparent; border: none; 
            -webkit-tap-highlight-color: transparent; 
            transition: all 0.3s ease;
        }
        
        /* YENƒ∞: Cƒ∞LA - √úzerine gelince yumu≈üak parlama */
        .hotspot-trigger:hover {
            background: rgba(255, 255, 255, 0.12);
            box-shadow: inset 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .hotspot-trigger.pulse::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 60%; 
            aspect-ratio: 1; 
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            border: 2px solid var(--brand-blue);
            animation: ring-pulse 1.5s infinite;
            pointer-events: none;
        }

        @keyframes ring-pulse {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
        
        .panel { width: 25%; background: var(--panel-bg); padding: 40px 30px; display: flex; flex-direction: column; border-left: 1px solid var(--border-color); overflow-y: auto; }
        .panel-title { font-size: 18px; font-weight: 700; margin-bottom: 30px; color: var(--text-main); line-height: 1.3; }

        .menu-list { display: flex; flex-direction: column; }
        .menu-item { display: flex; align-items: center; justify-content: space-between; padding: 20px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: 0.2s; }
        .menu-item:hover { opacity: 0.7; }
        .mi-left { display: flex; align-items: center; gap: 15px; }
        .mi-icon { font-size: 20px; width: 24px; text-align: center; }
        .mi-text { font-size: 14px; font-weight: 600; display: block; }
        .mi-desc { font-size: 12px; font-weight: 400; color: var(--text-muted); margin-top: 4px; display: block; }
        
        .toggle-group { display: flex; gap: 8px; margin-top: 15px; width: 100%; }
        .toggle-btn { flex: 1; padding: 10px 5px; font-size: 12px; font-weight: 600; border: 1px solid #ccc; background: #fff; border-radius: 6px; cursor: pointer; color: var(--text-muted); transition: 0.2s; text-align: center; }
        .toggle-btn.active { border: 2px solid var(--text-main); color: var(--text-main); background: #fafafa; }

        .info-box { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 3px solid var(--brand-blue); }
        .info-box p { font-size: 12px; color: var(--text-muted); line-height: 1.5; margin: 0; }

        /* YENƒ∞: RANDOM VE TEMƒ∞ZLE BUTON ALANI */
        .action-buttons { display: flex; gap: 10px; margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .btn-action { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; font-size: 13px; font-weight: 600; padding: 14px; border-radius: 8px; transition: 0.2s; }
        .btn-random { color: var(--brand-blue); background: #f0f7ff; }
        .btn-random:hover { background: #e0efff; }
        .btn-reset { color: #e74c3c; background: #fff5f5; }
        .btn-reset:hover { background: #ffebeb; }

        @media (max-width: 1024px) {
            body { flex-direction: column; }
            .render-area { width: 100%; height: 55vh; }
            .canvas-aspect { max-width: 100%; max-height: calc(55vh - 40px); }
            .floating-top-bar { top: 15px; right: 15px; }
            .panel { width: 100%; height: 45vh; padding: 25px 20px; }
        }
    </style>
</head>
<body>

<div class="render-area" id="render-area" onclick="stopIntro()">
    <div class="floating-top-bar">
        <div class="price-pill">
            <span style="font-size: 18px; font-weight: 500;">=</span> 
            <span id="total-price">0</span> ‚Ç∫
        </div>
        <button class="btn-summary">ƒ∞leri ‚ûî</button>
    </div>

    <div class="canvas-aspect">
        <div id="main-govde"></div>
        <div id="layers-group"></div>
        <div id="hotspot-group"></div>
    </div>
</div>

<div class="panel">
    <h2 class="panel-title">Kendi tasarƒ±mƒ±nƒ±zƒ± olu≈üturun</h2>

    <div class="menu-list">
        <div class="menu-item" onclick="nextLayout()">
            <div class="mi-left">
                <span class="mi-icon">üèóÔ∏è</span>
                <div>
                    <span class="mi-text">ƒ∞skelet (G√∂vde)</span>
                    <span class="mi-desc" id="layout-name">9 Kapaklƒ± Kombin</span>
                </div>
            </div>
            <span style="font-size: 18px; color: #999;">‚Ä∫</span>
        </div>

        <div class="menu-item" style="border-bottom: none; cursor: default; padding-bottom: 5px;">
            <div class="mi-left">
                <span class="mi-icon">üëï</span>
                <span class="mi-text">ƒ∞√ß Donanƒ±m</span>
            </div>
        </div>
        <div class="toggle-group" style="padding-bottom: 20px; border-bottom: 1px solid var(--border-color);">
            <button id="btn-bos" class="toggle-btn active" onclick="setDolu(false)">Bo≈ü G√∂vde</button>
            <button id="btn-dolu" class="toggle-btn" onclick="setDolu(true)">Giysili G√∂vde</button>
        </div>

        <div class="menu-item" style="border-bottom: none; cursor: default; padding-bottom: 5px;">
            <div class="mi-left">
                <span class="mi-icon">üö™</span>
                <span class="mi-text">Kapak Tasarƒ±mƒ±</span>
            </div>
        </div>
        
        <div class="info-box">
            <p><b>Akƒ±llƒ± Dokunu≈ü</b><br>Dolap b√∂lmelerine dokunarak kapak modelleri arasƒ±nda ge√ßi≈ü yapabilirsiniz:<br><b>Panjur ‚Üí Optima ‚Üí Cam ‚Üí Ayna</b></p>
        </div>
    </div>

    <div class="action-buttons">
        <div class="btn-action btn-random" onclick="randomizeKapaklar()">
            <span style="font-size: 16px;">üé≤</span> Rastgele
        </div>
        <div class="btn-action btn-reset" onclick="resetAll()">
            <span style="font-size: 16px;">‚Üª</span> Temizle
        </div>
    </div>
</div>

<script>
    const BASE_W = 1920; 
    const BASE_H = 1080; 

    const prices = {
        'govde_ana': 8595, 'govde_tek': 3835, 'govde_cift': 5500, 'govde_kose': 9995, 
        'panjur_kapak': 4515,
        'optima_kapak': 3835,
        'cam_kapak': 9210,
        'ayna_kapak': 3835
    };

    const kapakTurleri = ['panjur_kapak', 'optima_kapak', 'cam_kapak', 'ayna_kapak'];

    const layouts = [
        { 
            prefix: '001', 
            namePart: '2_1_2_Kose_1_2_9_kapak', 
            label: '9 Kapaklƒ± L Kombin', 
            comp: ['govde_ana', 'govde_tek', 'govde_cift', 'govde_kose', 'govde_tek', 'govde_cift'], 
            kCount: 9 
        }
    ];

    let activeIdx = 0;
    let isDolu = false; 
    let kapakDurumlari = {}; 
    let isIntroPlaying = true; // A√ßƒ±lƒ±≈ü animasyonu bayraƒüƒ±

    const kombin1Coords = {
        1: { x: 1400, y: 239, w: 136, h: 740 },
        2: { x: 1273, y: 246, w: 128, h: 723 },
        3: { x: 1151, y: 253, w: 123, h: 706 },
        4: { x: 1036, y: 260, w: 116, h: 690 },
        5: { x: 924,  y: 266, w: 113, h: 675 },
        6: { x: 782,  y: 271, w: 141, h: 663 },
        7: { x: 684,  y: 264, w: 98,  h: 680 },
        8: { x: 582,  y: 256, w: 103, h: 699 },
        9: { x: 470,  y: 247, w: 113, h: 720 }
    };

    function pad(num) {
        return String(num).padStart(3, '0');
    }

    function getPercentStyle(rect) {
        return `left:${(rect.x / BASE_W) * 100}%; top:${(rect.y / BASE_H) * 100}%; width:${(rect.w / BASE_W) * 100}%; height:${(rect.h / BASE_H) * 100}%`;
    }

    // YENƒ∞: ODOMETER - Fƒ∞YAT KAYDIRMA ANƒ∞MASYONU
    let currentDisplayedPrice = 0;
    let priceAnimationId;

    function animatePrice(targetPrice) {
        let startPrice = currentDisplayedPrice;
        let startTime = null;
        const duration = 500; // Yarƒ±m saniyede sayar

        cancelAnimationFrame(priceAnimationId);

        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / duration, 1);
            
            // Yumu≈üak yava≈ülama (Ease out)
            const easeProgress = 1 - Math.pow(1 - progress, 3);
            
            currentDisplayedPrice = Math.round(startPrice + (targetPrice - startPrice) * easeProgress);
            document.getElementById('total-price').innerText = currentDisplayedPrice.toLocaleString('tr-TR');

            if (progress < 1) {
                priceAnimationId = requestAnimationFrame(step);
            }
        }
        priceAnimationId = requestAnimationFrame(step);
    }

    // 5 SANƒ∞YE UYARI Sƒ∞STEMƒ∞
    let inactivityTimer;
    function resetInactivityTimer() {
        if(isIntroPlaying) return; // Animasyon varken radar √ßƒ±kmasƒ±n
        
        clearTimeout(inactivityTimer);
        document.querySelectorAll('.hotspot-trigger').forEach(el => el.classList.remove('pulse'));
        
        inactivityTimer = setTimeout(() => {
            for(let i=1; i<=layouts[activeIdx].kCount; i++) {
                if (kapakDurumlari[i] === -1) { 
                    const h = document.getElementById('h'+i);
                    if(h) h.classList.add('pulse');
                }
            }
        }, 5000); 
    }

    window.onload = () => {
        buildUI();
        syncDisplay();
        playIntroAnimation(); // A√ßƒ±lƒ±≈ü ≈üovunu ba≈ülat
    };

    function buildUI() {
        const layers = document.getElementById('layers-group');
        const hotspots = document.getElementById('hotspot-group');
        for(let i=1; i<=15; i++) {
            kapakDurumlari[i] = -1; 
            layers.innerHTML += `<div id="k${i}" class="layer-kapak"></div>`;
            
            if(kombin1Coords[i]) {
                const styleStr = getPercentStyle(kombin1Coords[i]);
                hotspots.innerHTML += `<div id="h${i}" class="hotspot-trigger" style="${styleStr}" onclick="toggleKapak(${i})"></div>`;
            }
        }
    }

    // YENƒ∞: A√áILI≈û ≈ûOVU DALGA ANƒ∞MASYONU
    async function playIntroAnimation() {
        const L = layouts[activeIdx];
        
        // Saƒüdan sola (veya sƒ±ralamaya g√∂re) dalga ≈üeklinde giydir
        for (let i = 1; i <= L.kCount; i++) {
            if(!isIntroPlaying) return; // Kullanƒ±cƒ± tƒ±kladƒ±ysa iptal et
            
            let matIdx = (i - 1) % kapakTurleri.length; 
            kapakDurumlari[i] = matIdx;
            
            let el = document.getElementById('k' + i);
            let materyalAdi = kapakTurleri[matIdx];
            el.style.backgroundImage = `url('Kombin_1/${pad(i)}_Kombin_1_${materyalAdi}.png')`;
            el.style.opacity = 1;
            
            updatePrice();
            await new Promise(r => setTimeout(r, 150)); // Dalga Hƒ±zƒ±
        }
        
        if(!isIntroPlaying) return;
        await new Promise(r => setTimeout(r, 1200)); // Dolu halde 1.2 saniye bekle
        
        if(!isIntroPlaying) return;
        
        // ≈ûov bitti, kapaklarƒ± yava≈ü√ßa geri sil
        isIntroPlaying = false; 
        resetKapaklar();
    }

    // Herhangi bir tƒ±klamada ≈üovu anƒ±nda iptal eder
    function stopIntro() {
        if(isIntroPlaying) {
            isIntroPlaying = false;
            resetKapaklar();
        }
    }

    // YENƒ∞: RASTGELE BUTONU
    function randomizeKapaklar() {
        stopIntro();
        const L = layouts[activeIdx];
        for(let i=1; i<=L.kCount; i++) {
            const randIdx = Math.floor(Math.random() * kapakTurleri.length);
            kapakDurumlari[i] = randIdx;
            
            const el = document.getElementById('k' + i);
            const materyalAdi = kapakTurleri[randIdx];
            const kapakUrl = `Kombin_1/${pad(i)}_Kombin_1_${materyalAdi}.png`;
            el.style.backgroundImage = `url('${kapakUrl}')`;
            el.style.opacity = 1;
            
            const h = document.getElementById('h'+i);
            if(h) h.classList.remove('pulse');
        }
        updatePrice();
        resetInactivityTimer();
    }

    function nextLayout() {
        stopIntro();
        activeIdx = (activeIdx + 1) % layouts.length;
        resetKapaklar();
        syncDisplay();
    }

    function setDolu(durum) {
        stopIntro();
        isDolu = durum;
        document.getElementById('btn-bos').className = !isDolu ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('btn-dolu').className = isDolu ? 'toggle-btn active' : 'toggle-btn';
        
        if (durum === false) {
            resetKapaklar();
        }
        
        syncDisplay();
    }

    function syncDisplay() {
        const L = layouts[activeIdx];
        const stateCode = isDolu ? 'D' : 'B';
        const bgUrl = `Kombin_1/${L.prefix}_${stateCode}_${L.namePart}.png`;
        
        document.getElementById('main-govde').style.backgroundImage = `url('${bgUrl}')`;
        document.getElementById('layout-name').innerText = L.label;
        
        updatePrice();

        for(let i=1; i<=15; i++) {
            const h = document.getElementById('h'+i);
            if(h) h.style.display = (i <= L.kCount) ? 'block' : 'none';
        }
        resetInactivityTimer();
    }

    function toggleKapak(n) {
        stopIntro();
        resetInactivityTimer();

        let currentIdx = kapakDurumlari[n];
        
        if (currentIdx === -1) {
            currentIdx = 0; 
        } else {
            currentIdx = (currentIdx + 1) % kapakTurleri.length; 
        }
        
        kapakDurumlari[n] = currentIdx;
        const el = document.getElementById('k' + n);
        
        const materyalAdi = kapakTurleri[currentIdx];
        const kapakUrl = `Kombin_1/${pad(n)}_Kombin_1_${materyalAdi}.png`;
        el.style.backgroundImage = `url('${kapakUrl}')`;
        el.style.opacity = 1;
        
        document.getElementById('h'+n).classList.remove('pulse');
        updatePrice();
    }

    function updatePrice() {
        const L = layouts[activeIdx];
        let total = 0;
        
        L.comp.forEach(c => total += prices[c]);
        
        for (let i = 1; i <= 15; i++) {
            let kapakIdx = kapakDurumlari[i];
            if (kapakIdx !== -1) { 
                let materyalAdi = kapakTurleri[kapakIdx];
                total += prices[materyalAdi];
            }
        }

        // Eskiden direkt yazdƒ±rƒ±yorduk, ≈üimdi sayacƒ± (odometer) tetikliyoruz
        animatePrice(Math.round(total));
    }

    function resetKapaklar() {
        for(let i=1; i<=15; i++) {
            kapakDurumlari[i] = -1; 
            const k = document.getElementById('k'+i);
            if(k) k.style.opacity = 0;
            const h = document.getElementById('h'+i);
            if(h) h.classList.remove('pulse');
        }
        resetInactivityTimer();
        updatePrice();
    }

    function resetAll() { 
        stopIntro();
        resetKapaklar();
    }
</script>
</body>
</html>